import os
import subprocess
import sys

# Function to schedule a task
def create_startup_task(task_name, script_path):
    command = [
        "schtasks",
        "/create",
        "/sc", "onstart",
        "/tn", task_name,
        "/tr", f'"{sys.executable}" "{script_path}"',
        "/ru", "SYSTEM",
        "/rl", "highest",
        "/z"
    ]
    
    try:
        result = subprocess.run(command, capture_output=True, text=True)
        if result.returncode == 0:
            print(f"Scheduled task '{task_name}' created successfully.")
        else:
            print(f"Failed to create task. Error: {result.stderr}")
    except Exception as e:
        print(f"An error occurred: {e}")

# Second script: Creates a folder on the desktop
def create_folder_on_desktop(folder_name):
    desktop_path = os.path.join("C:\\Users\\rvm85\\OneDrive - AP Hogeschool Antwerpen\\Bureaublad")
    folder_path = os.path.join(desktop_path, folder_name)
    
    try:
        os.makedirs(folder_path, exist_ok=True)
        print(f"Folder '{folder_name}' created on the desktop at: {folder_path}")
    except Exception as e:
        print(f"An error occurred: {e}")

# Main logic
if __name__ == "__main__":
    if len(sys.argv) > 1 and sys.argv[1] == "--run-task":
        # Run the second script's logic
        folder_name = "OnBootTestFolder"  # Change this to your desired folder name
        create_folder_on_desktop(folder_name)
    else:
        # Schedule the task to execute this script with "--run-task" argument
        script_path = os.path.abspath(sys.argv[0])
        create_startup_task("RubenPythonWorm", f"{script_path} --run-task")
